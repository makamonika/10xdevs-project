---
import AuthLayout from "@/layouts/AuthLayout.astro";
import { ForgotPasswordForm } from "@/components/auth/ForgotPasswordForm";
import { createSupabaseServerInstance } from "@/db/supabase.client";

/**
 * Password Reset Page
 *
 * Email Confirmation Behavior:
 * - If you just registered and haven't confirmed your email yet, you should check your
 *   inbox for the account confirmation email first. After confirming your account, you
 *   can use this page to reset your password if needed.
 *
 * - Password reset emails are sent regardless of email confirmation status, but you
 *   may need to confirm your account before being able to sign in with a new password.
 */

// Check if user is already authenticated
// Since /forgot-password is a public route, we need to manually check the session
const supabase = createSupabaseServerInstance({
  headers: Astro.request.headers,
  cookies: Astro.cookies,
});

const {
  data: { user },
} = await supabase.auth.getUser();

if (user) {
  return Astro.redirect("/");
}
---

<AuthLayout title="Forgot Password - SEO Query Insights Dashboard">
  <div class="space-y-6">
    <div class="space-y-2">
      <h2 class="text-2xl font-semibold text-foreground">Reset your password</h2>
      <p class="text-sm text-muted-foreground">We'll send you a link to reset your password</p>
    </div>

    <ForgotPasswordForm client:load />
  </div>
</AuthLayout>
