---
import AuthLayout from "@/layouts/AuthLayout.astro";
import { RegisterForm } from "@/components/auth/RegisterForm";
import { createSupabaseServerInstance } from "@/db/supabase.client";

/**
 * User Registration Page
 *
 * Email Confirmation Behavior:
 * - If email confirmation is DISABLED (auth.email.enable_confirmations = false):
 *   User is immediately logged in after registration and redirected to the dashboard.
 *
 * - If email confirmation is ENABLED (auth.email.enable_confirmations = true):
 *   User receives a confirmation email with a link. They must click the link to verify
 *   their account before they can sign in. The form will display a success message
 *   instructing them to check their email.
 *
 * Current configuration: Email confirmation is DISABLED (see supabase/config.toml line 176)
 */

// Check if user is already authenticated
// Since /register is a public route, we need to manually check the session
const supabase = createSupabaseServerInstance({
  headers: Astro.request.headers,
  cookies: Astro.cookies,
});

const {
  data: { user },
} = await supabase.auth.getUser();

if (user) {
  return Astro.redirect("/");
}
---

<AuthLayout title="Sign Up - SEO Query Insights Dashboard">
  <div class="space-y-6">
    <div class="space-y-2">
      <h2 class="text-2xl font-semibold text-foreground">Create an account</h2>
      <p class="text-sm text-muted-foreground">Get started with your SEO query insights</p>
    </div>

    <RegisterForm client:load />
  </div>
</AuthLayout>
